<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uponati Health Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <aside>
        <div class="logo close">
            <i data-lucide="activity"></i> Uponati
        </div>
        <nav>
            <a href="#" class="active" onclick="showView('home', this)"><i data-lucide="home"></i> ëŒ€ì‹œë³´ë“œ</a>
            <a href="#" onclick="showView('guide', this)"><i data-lucide="file-text"></i> ë§ì¶¤í˜• ê°€ì´ë“œ</a>
            <a href="#" onclick="showView('ocr', this)"><i data-lucide="camera"></i> ì˜ë£Œ OCR</a>
            <a href="#" onclick="showView('notification', this)"><i data-lucide="bell"></i> ì•Œë¦¼ ê´€ë¦¬</a>
            <a href="#" onclick="showView('mypage', this)"><i data-lucide="user"></i> My Page</a>
        </nav>
        <div class="close_btn"></div>
    </aside>

    <main>
        <!-- Home View -->
        <section id="home-view" class="view-section active">
            <header>
                <h1>ë°˜ê°‘ìŠµë‹ˆë‹¤, ì–´í¬ë‚˜í‹° ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤ ğŸ©º</h1>
                <p style="color: var(--text-muted); margin-top: 8px;">ì§„ë£Œ ê¸°ë¡ ê¸°ë°˜ ì§€ëŠ¥í˜• ë³µì•½ ë° ê´€ë¦¬ ê°€ì´ë“œ ì‹œìŠ¤í…œ</p>
            </header>

            <div class="dashboard-grid">
                <div class="card" onclick="showView('guide', this)">
                    <h3>ë§ì¶¤í˜• ê°€ì´ë“œ</h3>
                    <p>ì‚¬ìš©ìì˜ ì§„ë£Œ ë‚´ì—­ê³¼ ë³µì•½ ì •ë³´ë¥¼ ë¶„ì„í•˜ì—¬ LLMì´ ê°œì¸í™”ëœ ê±´ê°• ìƒí™œ ì§€ì¹¨ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
                </div>
                <!-- <div class="card" onclick="showView('chat', this)">
                    <h3>ì±—ë´‡</h3>
                    <p>ê¶ê¸ˆí•œ ê±´ê°• ì§ˆë¬¸ì— ëŒ€í•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒë‹´í•˜ê³  ì´ì „ ëŒ€í™” ë§¥ë½ì„ ê¸°ì–µí•˜ëŠ” AI ì±—ë´‡ì…ë‹ˆë‹¤.</p>
                </div> -->
                <div class="card" onclick="showView('ocr', this)">
                    <h3>OCR</h3>
                    <p>ì–´ë ¤ìš´ ì²˜ë°©ì „ ì´ë¯¸ì§€ë‚˜ ì•½ë´‰íˆ¬ë¥¼ ì°ì–´ ì˜¬ë¦¬ë©´ í…ìŠ¤íŠ¸ë¥¼ ì¸ì‹í•´ ì •ë³´ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>
                </div>
                <div class="card" onclick="showView('notification', this)">
                    <h3>ì•ŒëŒ</h3>
                    <p>ë³µì•½ ì‹œê°„ ë° ê¸°ê°„ ì•Œë¦¼ ì„¤ì •</p>
                </div>
            </div>
        </section>

        <!-- Guide View -->
        <section id="guide-view" class="view-section">
            <header>
                <h1>ë§ì¶¤í˜• ê°€ì´ë“œ ìƒì„±</h1>
            </header>
            <div class="card" style="max-width: 600px;">
                <div class="input-group">
                    <label>ì§„ë£Œ ê¸°ë¡ / ì¦ìƒ</label>
                    <textarea id="guide-medical" rows="4" placeholder="ì˜ˆ: ì–´ì§€ëŸ¬ì›€ì¦ì´ ìˆê³  ë‹¹ë‡¨ ìˆ˜ì¹˜ê°€ ë†’ê²Œ ë‚˜ì™”ìŒ..."></textarea>
                </div>
                <div class="input-group">
                    <label>í˜„ì¬ ë³µìš© ì¤‘ì¸ ì•½í’ˆ</label>
                    <input type="text" id="guide-medication" placeholder="ì˜ˆ: ë©”íŠ¸í¬ë¥´ë¯¼ 500mg">
                </div>
                <button class="btn-primary" onclick="generateGuide()">ê°€ì´ë“œ ìƒì„±í•˜ê¸° (LLM)</button>
                <div id="guide-result"
                    style="margin-top: 24px; white-space: pre-wrap; padding: 16px; background: var(--primary-light); border-radius: 12px; display: none;">
                </div>
            </div>
        </section>

        <!-- OCR View -->
        <section id="ocr-view" class="view-section">
            <header>
                <h1>ì˜ë£Œ ê¸°ë¡ OCR ì¸ì‹</h1>
            </header>
            <div class="card">
                <input type="file" id="ocr-file" accept="image/*,.pdf">
                <button class="btn-primary" style="margin-top: 16px;" onclick="uploadOCR()">ì´ë¯¸ì§€ ë¶„ì„ ì‹œì‘</button>
                <div id="ocr-result" style="margin-top: 20px; font-family: monospace; font-size: 0.9rem;"></div>
            </div>
        </section>

        <!-- Other Views (Stubs) -->
        <section id="media-view" class="view-section">
            <header>
                <h1>ì½˜í…ì¸  ë³€í™˜ (TTS/CardNews)</h1>
            </header>
            <p>ê°€ì´ë“œë¥¼ ìŒì„±ì´ë‚˜ ì¹´ë“œë‰´ìŠ¤ë¡œ ë°”ê¿‰ë‹ˆë‹¤ (ì¤€ë¹„ ì¤‘..)</p>
        </section>
        <section id="notification-view" class="view-section">
            <header>
                <h1>ì•Œë¦¼ ê´€ë¦¬</h1>
            </header>
            <p>ë³µì•½ ì•Œë¦¼ ìŠ¤ì¼€ì¤„ì„ ì„¤ì •í•©ë‹ˆë‹¤ (ì¤€ë¹„ ì¤‘..)</p>
        </section>

        <!-- Chat View -->
        <div class="chat-view">
            <div class="chat-window">
                <div id="chat-messages" class="chat-messages">
                    <div style="background: var(--bg-main); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                        ì˜ë£Œ ì „ë¬¸ AI ì±—ë´‡ì…ë‹ˆë‹¤. ì¦ìƒì´ë‚˜ ê±´ê°• ê´€ë¦¬ë²•ì— ëŒ€í•´ ë¬¼ì–´ë³´ì„¸ìš”!
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="chat-input-field" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="flex: 1">
                    <button class="btn-primary" style="width: auto;" onclick="sendChatMessage()">ì „ì†¡</button>
                </div>
            </div>
        </div>
        <div class="chat_btn">?</div>
    </main>

    <script>
        lucide.createIcons();

        function showView(viewId, el) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));

            document.getElementById(viewId + '-view').classList.add('active');
            el.classList.add('active');
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input-field');
            const box = document.getElementById('chat-messages');
            if (!input.value) return;

            const userText = input.value;
            box.innerHTML += `<div style="text-align: right; margin-bottom: 12px;"><span style="background: var(--primary); color: white; padding: 8px 12px; border-radius: 12px;">${userText}</span></div>`;
            input.value = '';

            const response = await fetch('/api/v1/chat/message', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: 1, messages: [{ role: 'user', content: userText }] })
            });
            const data = await response.json();
            box.innerHTML += `<div style="margin-bottom: 12px;"><span style="background: var(--border); padding: 8px 12px; border-radius: 12px;">${data.reply}</span></div>`;
            box.scrollTop = box.scrollHeight;
        }

        async function generateGuide() {
            const medRes = document.getElementById('guide-medical').value;
            const drugRes = document.getElementById('guide-medication').value;
            const resultBox = document.getElementById('guide-result');

            resultBox.style.display = 'block';
            resultBox.innerText = 'LLM ê°€ì´ë“œ ìƒì„± ì¤‘...';

            const response = await fetch('/api/v1/guide/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: 1, medical_records: medRes, medication_info: drugRes })
            });
            const data = await response.json();
            resultBox.innerText = data.guide_text;
        }

        async function uploadOCR() {
            const resBox = document.getElementById('ocr-result');
            resBox.innerText = 'ì´ë¯¸ì§€ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤ (í•„ìˆ˜ 3 í…ŒìŠ¤íŠ¸)...';
            // ì‹¤ì œ êµ¬í˜„ ì‹œ FormData ì „ì†¡ ë¡œì§ í•„ìš”
            const response = await fetch('/api/v1/ocr/extract_record', { method: 'POST', body: new FormData() });
            const data = await response.json();
            resBox.innerText = JSON.stringify(data, null, 2);
        }

        document.querySelector("aside .close_btn").addEventListener("click",()=>{
            let classList = document.querySelector("aside").classList
            if(classList.contains("close")){
                classList.remove("close")
            }else{
                classList.add("close")
            }
        })

        document.querySelector(".chat_btn").addEventListener("click",()=>{
            let classList = document.querySelector(".chat-view").classList
            if(classList.contains("close")){
                classList.remove("close")
            }else{
                classList.add("close")
            }
        })
    </script>
</body>

</html>